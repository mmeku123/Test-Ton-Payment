<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Telegram Mini App with Stars Payment</title>
    <!-- Include the Telegram Web App JavaScript API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
  </head>
  <body>
    <h1>My Game</h1>
    <p>Play the game and buy items using Telegram Stars!</p>
    <button id="buyItemButton">Buy Item with Stars</button>
    <!-- Button to buy an in-game item -->
    <div id="paymentStatus"></div>
    <!-- Status Display -->

    <script>
      // Initialize the Telegram Web App
      const tg = window.Telegram.WebApp;

      // Set up the "Buy Item" button click event
      document.getElementById("buyItemButton").addEventListener("click", () => {
        tg.MainButton.text = "Processing Payment...";
        tg.MainButton.show();
        openStarsPaymentPopup(); // Function to open the payment popup
      });

      // Function to open the payment popup
      function openStarsPaymentPopup() {
        // Example invoice data for Stars payment
        const invoiceData = {
          chat_id: tg.initDataUnsafe.user.id, // User ID from Telegram init data
          title: "Game Item Purchase",
          description: "Purchase a game item using Telegram Stars.",
          payload: "game-item-purchase", // Unique identifier for the transaction
          currency: "XTR", // Use 'XTR' for Telegram Stars currency
          prices: [{ label: "Game Item", amount: 1000 }], // Example price in smallest currency unit (1 XTR = 100 units)
          max_tip_amount: 10000, // Optional, maximum tip amount in the smallest units of the currency (1 XTR = 100 units)
          suggested_tip_amounts: [500, 1000, 2000], // Optional, suggested tip amounts in the smallest units of the currency
          provider_data: {}, // Additional provider-specific data (optional)
        };

        // Call the Telegram Web App API to open the payment popup
        tg.showPopupInvoice({
          title: invoiceData.title,
          description: invoiceData.description,
          currency: invoiceData.currency,
          payload: invoiceData.payload,
          prices: invoiceData.prices,
          max_tip_amount: invoiceData.max_tip_amount,
          suggested_tip_amounts: invoiceData.suggested_tip_amounts,
          provider_data: JSON.stringify(invoiceData.provider_data),
        })
          .then(() => {
            tg.MainButton.text = "Payment Successful!";
            tg.MainButton.show();
            document.getElementById("paymentStatus").innerText =
              "Item purchased successfully!";
          })
          .catch((error) => {
            console.error("Error opening payment popup:", error);
            tg.MainButton.text = "Payment Failed!";
            tg.MainButton.show();
            document.getElementById("paymentStatus").innerText =
              "Payment failed. Please try again.";
          });
      }
    </script>
  </body>
</html>
